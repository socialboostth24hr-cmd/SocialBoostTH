<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>สั่งซื้อ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:system-ui;background:#0b0216;color:#fff}
.box{max-width:420px;margin:30px auto;padding:20px;background:#14062b;border-radius:20px}
input,button{width:100%;margin-top:10px;padding:12px;border-radius:14px;border:none}
button{background:linear-gradient(90deg,#8b5cf6,#ec4899);font-weight:800;color:#fff}
</style>
</head>
<body>

<div class="box">
  <h2 id="name"></h2>
  <div id="price"></div>
  <input id="qty" type="number">
  <div>รวม: <b id="total"></b> บาท</div>
  <button onclick="submit()">ยืนยัน</button>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbyarc1hrJZzI6g_EtrpzIZLQUDSOAPM-TlndrZ4BxdEEqvHkFpftXQ7oCWEjCix6heq/exec";
const user=JSON.parse(localStorage.getItem("user"));
const service=JSON.parse(localStorage.getItem("selectedService"));
if(!user||!service) location.href="services.html";

name.innerText=service.service_name;
price.innerText=`ราคา ${service.price}/${service.unit}`;
qty.value=service.min;

qty.oninput=calc;
function calc(){
  total.innerText=(qty.value*service.price).toFixed(2);
}
calc();

function submit(){
  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"createOrder",
      user_id:user.user_id,
      service_code:service.service_code,
      service_name:service.service_name,
      qty:Number(qty.value),
      unit_price:service.price
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(!res.success){alert(res.message);return}
    user.credit=res.new_credit;
    localStorage.setItem("user",JSON.stringify(user));
    alert("สำเร็จ");
    location.href="orders.html";
  });
}
</script>

</body>
</html>