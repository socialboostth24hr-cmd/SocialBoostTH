<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>สั่งซื้อบริการ | SocialBoostTH</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:system-ui;background:#0b0216;color:#fff}
.container{max-width:420px;margin:30px auto;padding:24px;background:#14062b;border-radius:20px}
.card{background:#1a0936;padding:16px;border-radius:16px;margin-bottom:12px}
h1{text-align:center}
input{width:100%;padding:12px;border-radius:12px;border:none}
button{width:100%;padding:14px;border:none;border-radius:16px;font-weight:800;margin-top:10px}
</style>
</head>

<body>
<script>
const user = JSON.parse(localStorage.getItem("user"));
const service = JSON.parse(localStorage.getItem("selectedService"));
if(!user||!service){ location.href="services.html"; }
</script>

<div class="container">
  <h1>สั่งซื้อบริการ</h1>

  <div class="card">
    <b id="name"></b><br>
    ราคา <span id="price"></span> บาท / <span id="unit"></span>
  </div>

  <div class="card">
    <input id="qty" type="number">
  </div>

  <div class="card">
    รวม <b id="total">0</b> บาท
  </div>

  <button onclick="submitOrder()">ยืนยันสั่งซื้อ</button>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbyJIauTAb7zYXuoMqPaCjHsOm2CVxT7jdLlKYvzt5-5sugBFeFFp8Qk3pbDYLvBHPoK/exec";

name.innerText=service.name;
price.innerText=service.price;
unit.innerText=service.unit;
qty.min=service.min;
qty.max=service.max;
qty.value=service.min;

function calc(){
  total.innerText=(qty.value*service.price).toFixed(2);
}
qty.oninput=calc; calc();

function submitOrder(){
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"createOrder",
      user_id:user.user_id,
      service_code:service.code,
      service_name:service.name,
      qty:Number(qty.value),
      amount:Number(total.innerText)
    })
  }).then(r=>r.json()).then(res=>{
    if(!res.success) return alert(res.message);
    user.credit=res.new_credit;
    localStorage.setItem("user",JSON.stringify(user));
    location.href="orders.html";
  });
}
</script>
</body>
</html>