<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>เติมเงิน | SocialBoostTH</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#0b0216;
  --card:#14062b;
  --border:#3b1775;
  --purple:#8b5cf6;
  --pink:#ec4899;
}
body{
  margin:0;
  font-family:system-ui;
  background:linear-gradient(180deg,#0b0216,#14032a);
  color:#fff;
}
.box{
  max-width:420px;
  margin:26px auto;
  padding:22px;
}
h1{
  text-align:center;
  font-size:24px;
  font-weight:900;
  background:linear-gradient(90deg,var(--purple),var(--pink));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.card{
  margin-top:16px;
  background:linear-gradient(180deg,#1a0936,var(--card));
  border:1px solid var(--border);
  border-radius:20px;
  padding:18px;
}
label{
  font-size:14px;
  color:#c4b5fd;
}
input{
  width:100%;
  margin-top:8px;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--border);
  background:#120725;
  color:#fff;
  font-size:18px;
}
button{
  width:100%;
  margin-top:14px;
  padding:16px;
  border-radius:18px;
  border:none;
  font-size:16px;
  font-weight:900;
  background:linear-gradient(135deg,var(--purple),var(--pink));
  color:#fff;
  cursor:pointer;
}
.qr{
  margin-top:16px;
  text-align:center;
}
.amount{
  margin-top:8px;
  font-size:22px;
  font-weight:900;
  color:#fbcfe8;
}
.note{
  margin-top:12px;
  font-size:13px;
  line-height:1.6;
  color:#ddd6fe;
}
</style>
</head>

<body>
<div class="box">
  <h1>เติมเงินเข้าระบบ</h1>

  <div class="card">
    <label>จำนวนเงินที่ต้องการเติม (บาท)</label>
    <input id="amount" type="number" min="10" placeholder="เช่น 20">
    <button onclick="createTopup()">สร้าง QR ชำระเงิน</button>
  </div>

  <div id="result"></div>
</div>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbwP1C_zdlnjCXUSKjBwpq0q6p70Ke507W7bjtp1enfGVK3nWT6Saz9jVg1OU5O4o6V7/exec";

const user = JSON.parse(localStorage.getItem("user"));
if(!user){
  alert("กรุณาเข้าสู่ระบบ");
  location.href="index.html";
}

function createTopup(){
  const amt = Number(amount.value);
  if(amt < 10){
    alert("ขั้นต่ำ 10 บาท");
    return;
  }

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"createTopup",
      user_id:user.user_id,
      amount:amt
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(!res.success){
      alert(res.message);
      return;
    }

    result.innerHTML = `
      <div class="card qr">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=260x260&data=${encodeURIComponent(res.qr_text)}">
        <div class="amount">${res.pay_amount.toFixed(2)} บาท</div>
        <div class="note">
          ✅ สแกน QR เพื่อโอนเงิน<br>
          ⚠️ กรุณาโอน “ยอดตรงตามนี้เท่านั้น”<br>
          ระบบจะเติมเครดิตหลังแอดมินตรวจสอบ
        </div>
      </div>
    `;
  });
}
</script>
</body>
</html>