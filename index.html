<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>SocialBoostTH</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:system-ui;
  background:linear-gradient(180deg,#0b0216,#1a0438);
  color:#fff;
}
.container{
  max-width:420px;
  margin:30px auto;
  padding:24px;
  background:#120726;
  border-radius:18px;
}
h1{text-align:center;margin:0}
.sub{text-align:center;opacity:.85;margin-bottom:14px}
.box{
  background:#0f0220;
  border:1px solid #2e1065;
  padding:14px;
  border-radius:12px;
  margin-top:12px;
}
button, input, select{
  width:100%;
  padding:14px;
  margin-top:10px;
  border-radius:12px;
  border:1px solid #2e1065;
  background:#0f0220;
  color:#fff;
}
button{
  background:linear-gradient(90deg,#7c3aed,#5b21b6);
  font-weight:bold;
  border:none;
}
.small{font-size:13px;opacity:.7}
.logout{background:#111}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="container" id="loginBox">
  <h1>SocialBoostTH</h1>
  <div class="sub">
    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö<br>
    <span class="small">‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ LINE <b>@geg4960w</b></span>
  </div>

  <input id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
  <input id="password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
  <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  <div id="loginMsg" class="small"></div>
</div>

<!-- DASHBOARD -->
<div class="container" id="panel" style="display:none">
  <h1>SocialBoostTH</h1>
  <div class="box">
    ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <b id="username"></b><br>
    ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <b id="credit"></b>
  </div>

  <button onclick="openServices()">üìã ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</button>
  <button class="logout" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<!-- SERVICES -->
<div class="container" id="serviceBox" style="display:none">
  <h1>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h1>

  <div class="box">
    üáπüá≠ <b>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏ó‡∏¢</b>
    <div id="thaiList"></div>
  </div>

  <div class="box">
    üåç <b>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥</b>
    <div id="interList"></div>
  </div>

  <button onclick="back()">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<!-- ORDER -->
<div class="container" id="orderBox" style="display:none">
  <h1>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h1>

  <div class="box">
    <b id="serviceName"></b><br>
    <span class="small" id="serviceNote"></span>
  </div>

  <input id="qty" type="number">
  <input id="link" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏á‡∏≤‡∏ô">

  <div class="box">
    ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: <b id="totalPrice">0</b> ‡∏ö‡∏≤‡∏ó
  </div>

  <button onclick="confirmOrder()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
  <button onclick="back()">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<script>
const SHEET_ID = "10hFozE-vcdtPhX7KiGs3JTndpvxbUNDHDzhpvPxIz-4";
const USERS_API = `https://opensheet.elk.sh/${SHEET_ID}/users`;
const SERVICES_API = `https://opensheet.elk.sh/${SHEET_ID}/services`;
const GAS_API = "https://script.google.com/macros/s/AKfycby2utfzT3R0XymWtkmH41aVHVILkm5-irLcfTe2B3ETEs0Sq6KbHc8EqrFKWDS3ja3k/exec";

let user=null;
let services=[];
let selected=null;

/* INIT */
document.addEventListener("DOMContentLoaded",async()=>{
  services = (await fetch(SERVICES_API).then(r=>r.json())).filter(s=>s.status==="active");
  const s=localStorage.getItem("user");
  if(s){ user=JSON.parse(s); showPanel(); }
});

/* LOGIN */
async function login(){
  const users=await fetch(USERS_API).then(r=>r.json());
  const u=users.find(x=>x.email?.toLowerCase()===email.value.toLowerCase()
    && String(x.password).trim()===password.value.trim());
  if(!u){ loginMsg.innerText="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"; return; }

  user={user_id:u.user_id,fullname:u.fullname,credit:Number(u.credit)};
  localStorage.setItem("user",JSON.stringify(user));
  showPanel();
}

function showPanel(){
  loginBox.style.display="none";
  serviceBox.style.display="none";
  orderBox.style.display="none";
  panel.style.display="block";
  username.innerText=user.fullname;
  credit.innerText=user.credit;
}

/* SERVICES */
function openServices(){
  panel.style.display="none";
  serviceBox.style.display="block";

  thaiList.innerHTML="";
  interList.innerHTML="";

  services.forEach(s=>{
    const btn=`<button onclick='selectService("${s.service_code}")'>
      ${s.platform} | ${s.service_name} <br>
      <span class="small">${s.price_th} ‡∏ö‡∏≤‡∏ó / ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
    </button>`;

    if(s.category==="thai") thaiList.innerHTML+=btn;
    else interList.innerHTML+=btn;
  });
}

function selectService(code){
  selected=services.find(s=>s.service_code===code);
  serviceBox.style.display="none";
  orderBox.style.display="block";

  serviceName.innerText = selected.service_name;
  serviceNote.innerText = selected.note || "";
  qty.value = selected.min_qty;
  updateTotal();
}

qty.oninput=updateTotal;

function updateTotal(){
  const q=Number(qty.value);
  if(q<selected.min_qty||q>selected.max_qty){
    totalPrice.innerText="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
    return;
  }
  totalPrice.innerText=(q*selected.price_th).toFixed(2);
}

/* ORDER */
async function confirmOrder(){
  const q=Number(qty.value);
  const amount=q*selected.price_th;
  if(amount>user.credit){ alert("‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠"); return; }

  const res=await fetch(GAS_API,{
    method:"POST",
    body:JSON.stringify({
      user_id:user.user_id,
      service_code:selected.service_code,
      platform:selected.platform,
      qty:q,
      amount:amount,
      link:link.value
    })
  });
  const d=JSON.parse(await res.text());
  if(!d.success){ alert(d.message); return; }

  user.credit=d.credit;
  localStorage.setItem("user",JSON.stringify(user));
  alert("‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  showPanel();
}

function back(){ showPanel(); }
function logout(){ localStorage.clear(); location.reload(); }
</script>

</body>
</html>