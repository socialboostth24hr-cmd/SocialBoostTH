<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>SocialBoostTH</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;font-family:system-ui;
  background:linear-gradient(180deg,#0b0216,#1a0438);
  color:#fff;
}
.container{
  max-width:420px;margin:30px auto;padding:24px;
  background:#120726;border-radius:18px;
}
h1{text-align:center;margin:0}
.sub{text-align:center;opacity:.85;margin:14px 0}
.box{
  background:#0f0220;border:1px solid #2e1065;
  padding:14px;border-radius:12px;margin-top:12px;
}
button,input,textarea{
  width:100%;padding:14px;margin-top:10px;
  border-radius:12px;border:1px solid #2e1065;
  background:#0f0220;color:#fff;
}
button{
  background:linear-gradient(90deg,#7c3aed,#5b21b6);
  border:none;font-weight:bold;
}
.small{font-size:13px;opacity:.7}
.tab button{margin-top:6px}
.hidden{display:none}
.status-pending{color:#facc15}
.status-processing{color:#38bdf8}
.status-completed{color:#22c55e}

.popup{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:flex;align-items:center;justify-content:center;
}
.popup .box{max-height:80vh;overflow:auto}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="container" id="loginBox">
  <h1>SocialBoostTH</h1>
  <div class="sub">
    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö<br>
    <span class="small">‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ LINE <b>@geg4960w</b></span>
  </div>
  <input id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
  <input id="password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
  <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  <div id="loginMsg" class="small"></div>
</div>

<!-- DASHBOARD -->
<div class="container hidden" id="panel">
  <h1>SocialBoostTH</h1>
  <div class="box">
    ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <b id="username"></b><br>
    ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï: <b id="credit"></b>
  </div>
  <button onclick="openServices()">üìã ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</button>
  <button onclick="openOrders()">üì¶ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
  <button onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<!-- SERVICES -->
<div class="container hidden" id="serviceBox">
  <h1>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h1>
  <div class="tab">
    <button onclick="showTab('thai')">üáπüá≠ ‡πÑ‡∏ó‡∏¢</button>
    <button onclick="showTab('inter')">üåç ‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥</button>
    <button onclick="showTab('guarantee')">‚ôªÔ∏è ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</button>
  </div>

  <div id="serviceList"></div>
  <button onclick="back()">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<!-- ORDER -->
<div class="container hidden" id="orderBox">
  <h1>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h1>
  <div class="box">
    <b id="serviceName"></b><br>
    <span class="small" id="serviceNote"></span>
  </div>

  <input id="qty" type="number">
  <textarea id="comments" class="hidden" placeholder="1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î = 1 ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå"></textarea>
  <input id="link" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏á‡∏≤‡∏ô">

  <div class="box">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: <b id="totalPrice">0</b> ‡∏ö‡∏≤‡∏ó</div>
  <button onclick="openPolicy()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
  <button onclick="back()">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<!-- POLICY POPUP -->
<div class="popup hidden" id="policyPopup">
  <div class="box">
    <b>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</b><br><br>
    <div class="small">
      ‚Ä¢ ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ó‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå<br>
      ‚Ä¢ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ<br>
      ‚Ä¢ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ/‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô<br>
      ‚Ä¢ ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°<br>
    </div>
    <label>
      <input type="checkbox" id="acceptPolicy"> ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
    </label>
    <button onclick="confirmOrder()">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
    <button onclick="closePolicy()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<!-- ORDERS -->
<div class="container hidden" id="ordersBox">
  <h1>‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>
  <div id="ordersList" class="small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
  <button onclick="back()">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<script>
const SHEET_ID="10hFozE-vcdtPhX7KiGs3JTndpvxbUNDHDzhpvPxIz-4";
const USERS_API=`https://opensheet.elk.sh/${SHEET_ID}/users`;
const SERVICES_API=`https://opensheet.elk.sh/${SHEET_ID}/services`;
const ORDERS_API=`https://opensheet.elk.sh/${SHEET_ID}/orders`;
const GAS_API="https://script.google.com/macros/s/AKfycby2utfzT3R0XymWtkmH41aVHVILkm5-irLcfTe2B3ETEs0Sq6KbHc8EqrFKWDS3ja3k/exec";

let user=null,services=[],selected=null,orderTimer=null;

/* INIT */
document.addEventListener("DOMContentLoaded",async()=>{
  services=(await fetch(SERVICES_API).then(r=>r.json())).filter(s=>s.status==="active");
  const u=localStorage.getItem("user");
  if(u){user=JSON.parse(u);showPanel();}
});

/* LOGIN */
async function login(){
  const users=await fetch(USERS_API).then(r=>r.json());
  const u=users.find(x=>x.email?.toLowerCase()===email.value.toLowerCase()
    && String(x.password).trim()===password.value.trim());
  if(!u){loginMsg.innerText="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";return;}
  user={user_id:u.user_id,fullname:u.fullname,credit:Number(u.credit)};
  localStorage.setItem("user",JSON.stringify(user));
  showPanel();
}

function showPanel(){
  hideAll();
  panel.classList.remove("hidden");
  username.innerText=user.fullname;
  credit.innerText=user.credit;
}

/* SERVICES */
function openServices(){
  hideAll();serviceBox.classList.remove("hidden");
  showTab("thai");
}
function showTab(type){
  serviceList.innerHTML="";
  services.filter(s=>
    type==="thai"?s.category==="thai":
    type==="inter"?s.category==="inter":
    s.guarantee!=="none"
  ).forEach(s=>{
    serviceList.innerHTML+=`
      <button onclick="selectService('${s.service_code}')">
        ${s.service_name}<br>
        <span class="small">${s.price_th} ‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
      </button>`;
  });
}
function selectService(code){
  selected=services.find(s=>s.service_code===code);
  hideAll();orderBox.classList.remove("hidden");
  serviceName.innerText=selected.service_name;
  serviceNote.innerText=selected.note||"";
  qty.value=selected.min_qty;
  comments.classList.toggle("hidden",selected.service_type!=="comment");
  updateTotal();
}

/* CALC */
qty.oninput=updateTotal;
comments.oninput=()=>{
  qty.value=comments.value.trim().split("\n").filter(x=>x).length;
  updateTotal();
};
function updateTotal(){
  const q=Number(qty.value);
  totalPrice.innerText=(q*selected.price_th).toFixed(2);
}

/* ORDER */
function openPolicy(){policyPopup.classList.remove("hidden");}
function closePolicy(){policyPopup.classList.add("hidden");}
async function confirmOrder(){
  if(!acceptPolicy.checked){alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç");return;}
  const q=Number(qty.value),amount=q*selected.price_th;
  if(amount>user.credit){alert("‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏û‡∏≠");return;}

  const res=await fetch(GAS_API,{method:"POST",body:JSON.stringify({
    user_id:user.user_id,
    service_code:selected.service_code,
    platform:selected.platform,
    qty:q,
    amount:amount,
    link:link.value,
    comments:comments.value
  })});
  const d=JSON.parse(await res.text());
  if(!d.success){alert(d.message);return;}

  user.credit=d.credit;
  localStorage.setItem("user",JSON.stringify(user));
  alert("‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  showPanel();
}

/* ORDERS */
async function openOrders(){
  hideAll();ordersBox.classList.remove("hidden");
  loadOrders();
  orderTimer=setInterval(loadOrders,5000);
}
async function loadOrders(){
  const data=await fetch(ORDERS_API).then(r=>r.json());
  const my=data.filter(o=>String(o.user_id)===String(user.user_id)).reverse();
  ordersList.innerHTML=my.map(o=>`
    <div class="box">
      ${o.service_code}<br>
      ${o.qty} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ | ${o.amount} ‡∏ö‡∏≤‡∏ó<br>
      <span class="status-${o.status}">${o.status}</span>
    </div>`).join("");
}

/* UTIL */
function hideAll(){
  [loginBox,panel,serviceBox,orderBox,ordersBox].forEach(x=>x.classList.add("hidden"));
  clearInterval(orderTimer);
}
function back(){showPanel();}
function logout(){localStorage.clear();location.reload();}
</script>

</body>
</html>