<script>
const API = "https://script.google.com/macros/s/AKfycbzPwjgsZpvTviaOuWu_FWAD9yw1-64MsT49jO9muE3EmKkAFeX4zQYz1jsKZBK6qIMfgA/exec";

function login(){
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  const error = document.getElementById('error');

  error.textContent = '';

  if(!user || !pass){
    error.textContent = 'กรุณากรอกชื่อผู้ใช้งานและรหัสผ่าน';
    return;
  }

  fetch(`${API}?action=login&username=${encodeURIComponent(user)}&password=${encodeURIComponent(pass)}`)
    .then(r=>r.json())
    .then(res=>{
      if(!res.success){
        error.textContent = res.message || 'เข้าสู่ระบบไม่สำเร็จ';
        return;
      }

      localStorage.setItem('user_id', res.user.user_id);
      localStorage.setItem('username', res.user.username);
      localStorage.setItem('credit', res.user.credit);

      location.href = 'services.html';
    })
    .catch(()=>{
      error.textContent = 'ไม่สามารถเชื่อมต่อระบบได้';
    });
}
</script>
