<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbwUx7R2m0Jsubhrk35fOpN43sVVKXWr3iEBd0psuJejMEVZ_yKqEb6efxfsTj3bgPlo/exec";

const params = new URLSearchParams(location.search);
const PLATFORM = params.get("platform");
const CATEGORY = params.get("category");

fetch(API_URL,{
  method:"POST",
  body:JSON.stringify({ action:"getServices" })
})
.then(r=>r.json())
.then(res=>{
  if(!res.success){
    list.innerHTML="โหลดบริการไม่สำเร็จ";
    return;
  }

  list.innerHTML="";

  res.services
    .filter(s=>{
      if(PLATFORM && s.platform !== PLATFORM) return false;
      if(CATEGORY && s.category !== CATEGORY) return false;
      return true;
    })
    .forEach(s=>{
      const card = document.createElement("div");
      card.className="card";
      card.dataset.service = JSON.stringify(s);

      card.innerHTML=`
        <div class="name">${s.service_name}</div>
        <div class="meta">
          ขั้นต่ำ ${Number(s.min_qty).toLocaleString()}
          • สูงสุด ${Number(s.max_qty).toLocaleString()}
        </div>
        <div class="price">
          ${Number(s.price).toFixed(3)} บาท / 1 หน่วย
        </div>
        ${s.note ? `<div class="badge">${s.note}</div>` : ""}
      `;

      card.onclick=()=>{
        localStorage.setItem("selectedService", card.dataset.service);
        location.href="order.html";
      };

      list.appendChild(card);
    });
})
.catch(()=>{
  list.innerHTML="เชื่อมต่อระบบไม่ได้";
});
</script>