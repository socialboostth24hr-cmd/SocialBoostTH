<script>
const API="https://script.google.com/macros/s/AKfycbxsz0AEvBctJc9UrbenP4yYarsPfFZsdSsuUBFQ78xnQ3_fgHp7O9vJr6RaXlmlt8lv5w/exec";
const API_KEY="SBTH-SECURE-2026";

/* CREDIT */
const credit = Number(localStorage.getItem('credit')||0);
document.getElementById('credit').textContent = credit.toFixed(2);

const box = document.getElementById('services');

/* ‚úÖ LOAD SERVICES (‡πÉ‡∏ä‡πâ action ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏£‡∏¥‡∏á) */
fetch(`${API}?action=services&api_key=${API_KEY}`)
.then(r=>r.json())
.then(list=>{
  if(!Array.isArray(list) || !list.length){
    box.innerHTML = '<div style="color:#94a3b8">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</div>';
    return;
  }

  list.forEach(s=>{
    box.insertAdjacentHTML('beforeend',`
      <div class="service">
        <h3>${s.display_name}</h3>
        <div class="desc">${s.short_desc||''}</div>
        <div class="meta">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ${s.min_qty} ${s.unit}</div>
        <div class="price">${s.price_per_100} ‡∏ö‡∏≤‡∏ó / 100 ${s.unit}</div>

        <div class="actions">
          <button class="btn ghost"
            onclick='openDetail("${s.display_name}",[
              "‚è± ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1‚Äì3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á",
              "‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ 24 ‡∏ä‡∏°.",
              "üîí ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô",
              "üíé ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç"
            ])'>
            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
          </button>
          <button class="btn primary" onclick="selectService('${s.service_id}')">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
          </button>
        </div>
      </div>
    `);
  });
})
.catch(err=>{
  console.error(err);
  box.innerHTML='<div style="color:#fb7185">‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>';
});

/* SELECT */
function selectService(id){
  localStorage.setItem('service_id',id);
  location.href='orders.html';
}

/* DETAIL */
function openDetail(name,items){
  document.getElementById('detailName').textContent=name;
  const ul=document.getElementById('detailList');
  ul.innerHTML='';
  items.forEach(i=>ul.insertAdjacentHTML('beforeend',`<li>${i}</li>`));
  document.getElementById('overlay').style.display='block';
  document.getElementById('modal').style.display='block';
}
function closeDetail(){
  document.getElementById('overlay').style.display='none';
  document.getElementById('modal').style.display='none';
}
</script>