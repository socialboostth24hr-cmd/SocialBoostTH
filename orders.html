<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Order ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | SocialBoostTH</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg-main:#0b0216;
  --bg-card:#14062b;
  --border:#3b1775;
  --purple:#8b5cf6;
  --pink:#ec4899;
  --soft:rgba(255,255,255,.7);
  --yellow:#facc15;
  --blue:#38bdf8;
  --green:#22c55e;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui;
  background:
    radial-gradient(1000px 500px at top,#2a0d52,transparent),
    linear-gradient(180deg,var(--bg-main),#14032a);
  color:#fff;min-height:100vh;
}
.container{
  max-width:420px;margin:30px auto;padding:26px;
  background:linear-gradient(180deg,#1a0936,var(--bg-card));
  border-radius:22px;
  box-shadow:0 25px 70px rgba(0,0,0,.55);
}
h1{
  text-align:center;font-size:26px;font-weight:900;margin:0;
  background:linear-gradient(90deg,var(--purple),var(--pink));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.sub{text-align:center;margin:12px 0 22px;color:var(--soft);font-size:14px}

.order{
  background:rgba(255,255,255,.04);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;margin-bottom:14px;
  cursor:pointer;
}
.order.latest{
  border-color:var(--purple);
  box-shadow:0 0 0 1px rgba(139,92,246,.6),
             0 0 18px rgba(139,92,246,.35);
}
.order-title{
  font-size:15px;font-weight:800;color:#e9d5ff;margin-bottom:6px;
}
.order-info{font-size:13px;color:var(--soft);line-height:1.6}
.status{margin-top:8px;font-size:13px;font-weight:800}
.status.pending{color:var(--yellow)}
.status.processing{color:var(--blue)}
.status.completed{color:var(--green)}

.empty{text-align:center;color:var(--soft);margin:30px 0}

button{
  width:100%;padding:14px;border:none;border-radius:16px;
  font-weight:800;background:#1e293b;color:#fff;cursor:pointer;
}

/* popup */
.popup{
  position:fixed;inset:0;background:rgba(0,0,0,.7);
  display:none;align-items:center;justify-content:center;z-index:99;
}
.popup .box{
  width:90%;max-width:380px;
  background:linear-gradient(180deg,#1a0936,var(--bg-card));
  border-radius:20px;border:1px solid var(--border);
  padding:20px;
}
.popup h2{
  margin:0 0 10px;font-size:18px;
  background:linear-gradient(90deg,var(--purple),var(--pink));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.popup .info{font-size:14px;color:var(--soft);line-height:1.7}
.popup button{margin-top:14px}
</style>
</head>

<body>

<script>
/* ===== LOGIN GUARD ===== */
const user = JSON.parse(localStorage.getItem("user"));
if(!user){
  location.href="index.html";
}
</script>

<div class="container">
  <h1>Order ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>
  <div class="sub">
    ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô<br>
    <span style="font-size:12px;opacity:.6">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</span>
  </div>

  <div id="ordersList">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

  <button onclick="goBack()">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Dashboard</button>
</div>

<!-- POPUP -->
<div class="popup" id="popup">
  <div class="box">
    <h2 id="popupTitle"></h2>
    <div class="info" id="popupInfo"></div>
    <button onclick="closePopup()">‡∏õ‡∏¥‡∏î</button>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const SHEET_ID = "10hFozE-vcdtPhX7KiGs3JTndpvxbUNDHDzhpvPxIz-4";
const ORDERS_API = `https://opensheet.elk.sh/${SHEET_ID}/orders`;
const USER_ID = String(user.user_id);

let cachedOrders = [];

/* ===== LOAD ORDERS ===== */
function loadOrders(){
  fetch(ORDERS_API)
    .then(r=>r.json())
    .then(data=>{
      cachedOrders = data
        .filter(o => String(o.user_id) === USER_ID)
        .reverse();
      renderOrders(cachedOrders);
    })
    .catch(()=>{
      ordersList.innerHTML =
        "<div class='empty'>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>";
    });
}

loadOrders();
setInterval(loadOrders,10000);

function renderOrders(list){
  if(!list.length){
    ordersList.innerHTML =
      "<div class='empty'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>";
    return;
  }

  ordersList.innerHTML = list.map((o,idx)=>`
    <div class="order ${idx===0?'latest':''}"
         data-index="${idx}">
      <div class="order-title">
        ${o.service_name || o.service_code}
      </div>
      <div class="order-info">
        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${o.qty}<br>
        ‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞: ${Number(o.amount).toFixed(2)} ‡∏ö‡∏≤‡∏ó
      </div>
      <div class="status ${o.status}">
        ${o.status==="pending"?"‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£":
          o.status==="processing"?"‚öôÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£":
          "‚úÖ ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"}
      </div>
    </div>
  `).join("");

  document.querySelectorAll(".order").forEach(el=>{
    el.onclick = ()=>openPopup(cachedOrders[el.dataset.index]);
  });
}

/* ===== POPUP ===== */
function openPopup(o){
  popupTitle.innerText = o.service_name || o.service_code;
  popupInfo.innerHTML = `
    üì¶ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${o.qty}<br>
    üí∞ ‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞: ${Number(o.amount).toFixed(2)} ‡∏ö‡∏≤‡∏ó<br>
    üìå ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${o.status}<br>
    üïí ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${o.created_at || "-"}<br>
    üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏á‡∏≤‡∏ô: ${o.link || "-"}
  `;
  popup.style.display="flex";
}
function closePopup(){ popup.style.display="none"; }

function goBack(){
  location.href="dashboard.html";
}
</script>

</body>
</html>