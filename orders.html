<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | SocialBoostTH</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#020617;
  --card:#0b1220;
  --border:#1f2937;
  --muted:#94a3b8;
  --blue:#38bdf8;
  --yellow:#f59e0b;
  --green:#22c55e;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:linear-gradient(180deg,#020617,#020617);
  color:#e5e7eb;
}
.wrap{
  max-width:720px;
  margin:auto;
  padding:18px 16px 100px;
}
h1{
  margin:0 0 14px;
  font-size:26px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
  margin-bottom:14px;
}
.row{
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.small{font-size:12px;color:var(--muted)}
.badge{
  padding:4px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:800;
}
.pending{background:rgba(245,158,11,.15);color:var(--yellow)}
.processing{background:rgba(56,189,248,.15);color:var(--blue)}
.success{background:rgba(34,197,94,.18);color:var(--green)}
.price-box{
  display:flex;
  gap:10px;
  margin-top:8px;
}
.price{
  background:#020617;
  padding:6px 12px;
  border-radius:10px;
  font-size:13px;
}
.price b{font-size:14px}
.link{
  margin-top:6px;
  color:var(--blue);
  cursor:pointer;
  font-size:13px;
}
.detail-btn{
  margin-top:10px;
  padding:10px;
  border-radius:999px;
  border:none;
  background:linear-gradient(135deg,#38bdf8,#8b5cf6);
  color:#fff;
  font-weight:900;
  width:100%;
}
.empty{
  text-align:center;
  color:var(--muted);
  padding:40px 10px;
}
</style>
</head>

<body>

<div class="wrap">
  <h1>üì¶ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>
  <div id="list" class="empty">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</div>
</div>

<script>
/* ================= CONFIG ================= */
const API_BASE = "https://script.google.com/macros/s/AKfycbyB5X9n_8U8huJJKC3O3r2n-gv-59oifcnzi2D6AaLcs5ul4-jFFbrcmzKglG5LYFX6iA/exec";
const API_KEY  = "SBTH-SECURE-2026";

/* ================= AUTH ================= */
const user_id = localStorage.getItem("user_id");
if(!user_id){
  location.href="login.html";
}

/* ================= UTILS ================= */
function formatTH(dateStr){
  const d=new Date(dateStr);
  return d.toLocaleString("th-TH",{dateStyle:"medium",timeStyle:"short"});
}
function shortLink(url){
  if(!url) return "-";
  return url.length>38 ? url.slice(0,35)+"‚Ä¶" : url;
}
function statusBadge(s){
  if(s==="processing") return `<span class="badge processing">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</span>`;
  if(s==="success") return `<span class="badge success">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>`;
  return `<span class="badge pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>`;
}

/* ================= LOAD ORDERS ================= */
fetch(`${API_BASE}?action=getOrders&api_key=${API_KEY}&user_id=${user_id}`)
  .then(r=>r.json())
  .then(res=>{
    const list=document.getElementById("list");
    if(!res.success || !res.orders.length){
      list.innerHTML=`<div class="empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>`;
      return;
    }

    list.innerHTML="";
    res.orders.reverse().forEach(o=>{
      const card=document.createElement("div");
      card.className="card";

      card.innerHTML=`
        <div class="row">
          <b>#${o[0]}</b>
          ${statusBadge(o[10])}
        </div>

        <div class="small">${formatTH(o[9])}</div>

        <div class="price-box">
          <div class="price">‡∏õ‡∏Å‡∏ï‡∏¥<br><b>${o[4]}</b></div>
          <div class="price">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î<br><b>${o[5]}%</b></div>
          <div class="price">‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á<br><b>${o[6]}</b></div>
        </div>

        <div class="link" onclick="window.open('${o[7]}')">
          üîó ${shortLink(o[7])}
        </div>

        <button class="detail-btn" onclick="openDetail('${o[0]}')">
          ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        </button>
      `;
      list.appendChild(card);
    });
  })
  .catch(()=>{
    document.getElementById("list").innerHTML=
      `<div class="empty">‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>`;
  });

/* ================= DETAIL ================= */
function openDetail(orderId){
  localStorage.setItem("order_id",orderId);
  location.href="order_detail.html";
}
</script>

</body>
</html>